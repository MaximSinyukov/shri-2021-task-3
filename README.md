# shri-2021-task-3

# Задача выявить ошибки в коде. Что удалось найти и исправить:

## Попытался запустить проект. Возникли следующие ошибки:
  1. В конфигурации вебпака не установлен мод для разработки или продакшн. Добавил в конфиг вебпака по умолчанию мод разработки. А для вызова скрипта `build` добавил мод продакшн сборки.
  2. В файле `application/action.ts` не был экспортирован тип действия `update`. Добавил его в экспорт.

## Ошибки при запуске приложения пропали. Перейдем к функциональности проекта:
1. Решил идти по функциональности задания. Начал с кнопок изменения темы. Внезапно была обнаружена ошибка, а именно на элемент `body` добавлялись неограниченно классы. Я решил заменять целиком класслист для исключения возможности дублирования классов.
2. Дальше я решил заняться работой с переключением слайдов. Самой очевидной и первой ошибкой было устранение неверного названия функции `actionNext` в постановке слушателя. Потом мне казалось возможным наличие ошибки в функции `createState`, что очень напоминала реактовский хук и вызывала интерес своей реализацией. Но мое расследование зашло в тупик, я потратил не один час на понимание ее внутренних составляющих. Пришлось выставлять не мало `console.log'ов` для убеждения в правильности работы. Хотя большая часть кода становилась ясна. После этого я стал подумывать на неверную реализацию фреймов, мол данные не приходят в `postMessage` или `renderTemplate` не в тот `body` рендерит. Но и эта версия оказалось неверной после нескольких тестов. Черед пришел за одной из последних функций в `index.ts`, а именно `createCurrentIndexSelector`. Как оказалось, эта функция получает параметр типа `never`, что означает невозвращаемое значение. Я копнул глубже в файл ее экспорта. Внутри нее была реализована обработка потока  в `pipe`, где у каждого передаваемого стейта извлекался индекс, отбирались только уникальные значения и последним действием каждое отфильтрованное значение превращалось в `never` через вызов `mergeMapTo(EMPTY)`. После удаления этого вызова переключение заработало.
3. Установил темную тему по умолчанию. Поменял первоначальное значение на элементах `body` в `html` файлах. В файле `state.ts` поставил в дефолтном состоянии темную тему для слайдов.
